<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tortoise Bench Testing Page</title>
</head>

<body>
	<script src="tortoise-compiler.js"></script>
	<script src="tortoise-engine.js"></script>

	<input type="text" id="model_name" placeholder="Model Name">
	<button id="test_js">Test JS</button>
	<button id="test_wasm">Test Wasm</button>
	<!-- <div id="view-container" style="height: 600px; width: 600px;"></div> -->

	<script>
		function loadJs(model_name) {
			return new Promise((resolve, reject) => {
				let script = document.createElement('script');
				script.src = `models/${model_name}/javascript.js`;
				script.async = true;
				script.onload = () => resolve();
				script.onerror = () => reject(new Error(`Failed to load script at ${script.src}`))
				document.body.appendChild(script);
			});
		}
		function runJs(timerName) {
			console.time(timerName);
			window.ProcedurePrims.callCommand("setup")
			for (let i = 0; i < 1000; i++) {
				window.ProcedurePrims.callCommand("go")
			}
			console.timeEnd(timerName);
		}

		var wasmResult = null
		async function loadWasm(model_name) {
			let obj = await WebAssembly.instantiateStreaming(fetch(`models/${model_name}/wasm.wasm`), {});
			wasmResult = obj;
		}
		function runWasm(timerName) {
			console.time(timerName);
			wasmResult.instance.exports.main();
			console.timeEnd(timerName);
			wasmResult = null;
		}

		document.addEventListener('DOMContentLoaded', () => {
			document.getElementById('test_js').addEventListener('click', async () => {
				await loadJs(document.getElementById('model_name').value);
				runJs('running JavaScript version');
				console.log("done");
			});

			document.getElementById('test_wasm').addEventListener('click', async () => {
				await loadWasm(document.getElementById('model_name').value);
				runWasm('running Wasm version');
				console.log("done");
			});
		});
	</script>
</body>

</html>