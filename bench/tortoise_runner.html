<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Tortoise Bench Testing Page</title>
</head>

<body>
	<input type="text" id="model_name" placeholder="Model Name">
	<button id="load">Load</button>
	<button id="run_main">
		<pre>main()</pre>
	</button>
	<button id="run_perf_trials">
		perf trials
	</button>

	<script src="tortoise-compiler.js"></script>
	<script src="tortoise-engine.js"></script>

	<script>
		var modelName = null;

		async function load() {
			console.log("loading");
			modelName = document.getElementById('model_name').value;
			const urlResp = await fetch(`models/${modelName}/tortoise_output_link.txt`);
			const url = await urlResp.text();
			const modelCodeResp = await fetch(url);
			const modelCode = await modelCodeResp.text();
			const blobUrl = URL.createObjectURL(new Blob([modelCode], { type: 'text/javascript' }));
			const script = document.createElement('script');
			script.src = blobUrl;
			script.async = true;
			document.body.appendChild(script);
			await new Promise((resolve, reject) => {
				script.onload = () => resolve();
				script.onerror = () => reject(new Error(`Failed to load script at ${script.src}`))
			});
			console.log("loaded");
		}

		function runPerfTrials() {
			console.time("perf_trials");
			window.ProcedurePrims.callCommand("perf_trials")
			console.timeEnd("perf_trials");
			alert("perf trials complete");
		}
		function perfTrials(timerName) {
			for (let trial = 0; trial < 1; trial++) {
				window.ProcedurePrims.callCommand("setup")
				for (let tick = 0; tick < 1000; tick++) {
					window.ProcedurePrims.callCommand("go")
				}
			}
		}

		document.addEventListener('DOMContentLoaded', () => {
			document.getElementById('load').addEventListener('click', load);
			document.getElementById('run_perf_trials').addEventListener('click', runPerfTrials);
		});
	</script>
</body>

</html>